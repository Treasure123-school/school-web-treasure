services:
  - type: web
    name: school-management-backend
    env: node
    region: oregon
    buildCommand: npm install --include=dev && npm run build
    startCommand: npm run start
    # IMPORTANT: This app uses local SQLite database (server/data/app.db)
    # You MUST enable persistent disk storage in Render dashboard:
    # 1. Go to your service settings
    # 2. Add a persistent disk mounted at /opt/render/project/src/server/data
    # 3. Set size to at least 1GB to store database and backups
    # 4. File uploads are stored in server/uploads/ (also requires persistent disk)
    envVars:
      - key: NODE_ENV
        value: production
      - key: FRONTEND_URL
        sync: false
      - key: SESSION_SECRET
        generateValue: true
      - key: JWT_SECRET
        generateValue: true
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false
      - key: GOOGLE_CALLBACK_URL
        sync: false
      - key: BACKEND_URL
        sync: false
    healthCheckPath: /api/health
    autoDeploy: true
